name: AnalyStock Debug

on: 
  workflow_dispatch:
  workflow_call:
  pull_request:
    branches:
      - master
   

env:
  workflow_cache_key: ${{ github.run_id }}/cache/debug  
  workflow_path: |
    build
    src
    tmp
  
  
jobs:
  restore: 
    name: Restore
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3
      - uses: actions/cache@v2
        with:
          path: ${{ env.workflow_path }}
          key: ${{ env.workflow_cache_key }}-restore

      - run: dotnet restore src/AnalyStock.sln
  
  build:
    needs: restore
    name: Build
    runs-on: ubuntu-latest

    steps:
      - uses: actions/cache@v2
        with:
          path: ${{ env.workflow_path }}
          key: ${{ env.workflow_cache_key }}-build
          restore-keys: ${{ env.workflow_cache_key }}-restore

      

      - run: dotnet build --no-restore src/AnalyStock.sln

  test:
    needs: build
    name: Test
    runs-on: ubuntu-latest

    steps:
      - uses: actions/cache@v2
        with:
          path: ${{ env.workflow_path }}
          key: ${{ env.workflow_cache_key }}-test
          restore-keys: ${{ env.workflow_cache_key }}-build

      - run: dotnet test --no-build src/AnalyStock.sln